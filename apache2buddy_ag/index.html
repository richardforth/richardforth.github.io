<!DOCTYPE html>
<html>
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>apache2buddy.pl Administrators Guide.</title>
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
        <link rel="stylesheet" type="text/css" href="resources/css/style.css">
	</head>
    <body>
        
        <nav class="navbar navbar-expand-lg navbar-dark bg-dark sticky-top">

            <a class="navbar-brand" href="#">apache<strong>2</strong>buddy.pl</a>
          <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarText" aria-controls="navbarText" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarText">
            <ul class="navbar-nav ml-auto">
              <li class="nav-item active">
                <a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#section-intro">Intro</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#goals">Goals</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#bestpractices">Best-Practices</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#walkthrough">Walkthrough</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#origins">Origins</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#usecases">Use-Cases</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#known-issues">Known issues</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#publicity">Publicity</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#cookies">Cookies</a>
              </li>
            </ul>
          </div>
        </nav>
        
        <section class="container">
            <div class="jumbotron">
              <h1 class="display-4">apache2buddy.pl</h1>
              <p class="lead">Administrator's Guide</p>
              <hr class="my-4">

              <a class="btn btn-primary btn-lg" href="https://github.com/richardforth/apache2buddy" role="button">Code</a>
              <a class="btn btn-warning btn-lg" href="https://github.com/richardforth/apache2buddy/issues" role="button">Issues</a>
              <div class="alert alert-warning" role="alert">
                  &#9851; This site is under development &amp; refactoring, please bear with me if some elements dont display correctly during this time. 
              </div>
            </div>
        </section>
        <a id="section-intro"></a>
        <section class="container">
            
            <p style="page-break-before: always"></p>
            <h2>Introduction and target audience.</h2>
            <p>
                Thanks for visiting this documentation, I truly believe you've made the right decision, as this contains all I have to offer in terms of learning how to use this powerful tool in the spirit of the way it was originally designed, and intended to be used.
            </p>
            <p>
                My name is Richard Forth and I am the author of apache2buddy.pl. In this document I offer my own personal insights into history, new features, usage, best practice, and tips and tricks to get the best experience with apache2buddy.pl for yourself and your customers - be they yourself, internal reporting lines or external customers or peers.
            </p>
            <p>
                This document is aimed at System Administrators who work with apache webservers on a regular basis, and have a need to tune and troubleshoot apache installations at a variety of levels of technical ability. Ideally you will have 18 months' minimum experience working with Linux systems. This document assumes you are already technical at the intermediate to advanced level.
            </p>
            <p>
                I hope this document delivers all the knowledge it promises whilst keeping you engaged and entertained!
            </p>
            <p>
                Lets begin...
            </p>
            <div class="no-print container">
                <div class="backtop"><a href="#top">^ Back to top ^</a></div>
            </div>
        </section>
        <div class="no-print">
            <div class="clearscroll"></div>
        </div>
        <a id="goals"></a>
        <section class="container">
            <a id="goals"></a>
            <p style="page-break-before: always"></p>
            <h2>Goals of this Document: What you can expect to know.</h2>
            <p>
                By the end of this document, you will be fully up to speed on the history, support, usage and interpretation of the <strong>apache2buddy.pl</strong> script used to tune / troubleshoot apache webserver installations.
            </p>
            <p>
                Things you will know and be able to do after reading this document:
            </p>
            <ul>
                <li>Know the history of apache2buddy, including learning about the GrandFather of apache tuning, the <em>original</em> apachebuddy.pl script</li>
                <li>Know where to find the <em>original</em> <strong>apachebuddy.pl</strong> script, and see examples of it's execution.</li>
                <li>Acknowledge that apache2buddy was based on, and owes a lot of credit to the <em>original</em> apachebuddy project.</li>
                <li>Know and understand the needs and requirements that led to the creation of the apache2buddy project.</li>
                <li>Learn all of the powerful new features that sets apache2buddy apart as a world-class apache tuning script and how  it has evolved into a separate product in its own right.</li>
                <li>Discover online articles written about apache2buddy.pl in the press.</li>
                <li>Make technical comparisons between apachebuddy.pl and apache2buddy.pl</li>
                <li>Understand when apache2buddy.pl is most useful to run, and why.</li>
                <li>Understand when apache2buddy.pl is least useful to run, and why.</li>
                <li>How to use checksums to validate the script before execution.</li>
                <li>Learn about typo-squatting and why apache2buddy.pl (the internet domain name) was not used for curl and perl operations.</li>
                <li>Learn where apache2buddy.pl lives.</li>
                <li>Learn the importance of checking check-sums, and how to do this to verify the code.</li>
                <li>Learn why running arbitrary code as root can be dangerous (and lets be clear, apache2buddy.pl is arbitrary code).</li>
                <li>How to get and execute the apache2buddy.pl script on your systems once you are happy it isn't going to do anything malicious.</li>
                <li>How to interpret the script results and how to use the findings appropriately in your investigations.</li>
                <li>Learn Best Practices based on knowledge gained regarding how to convey apache2buddy findings to your customers, peers, and managers to make a case for change (hardware / software configuration).</li>
                <li>Understand the Operating Systems supported by apache2buddy.</li>
                <li>Understand how product lifecycle affects apachebuddy execution over time.</li>
                <li>Understand what to do when you encounter a system that apache2buddy refuses to run on.</li>
                <li>Make minor edits to the perl script to meet one time executions on EOL/Unsupported Systems, where apache2buddy otherwise refuses to run.</li>
                <li>Understand the limitations and known issues with the script, as of this writing.</li>
                <li>Understand how to raise issues on github to request features or fixes to errors.</li>
                <li>How you can contribute to the project using pull requests/issue tracker.</li>
            </ul>
            <p>
                Be aware that this is a living document that will be updated regularly, if you find a bullet point above that has not been covered in as much detail as you like, or is missing after a few weeks, raise an issue <a href="https://github.com/richardforth/richardforth.github.io" target="_blank">here</a> and I will make sure to cover that topic in more depth / add relevant sections.</p>
                <p>I havent added a navigation bar yet but there are plans to add navigation and support for mobile devices but that's quite a lot of CSS and jquery heavy lifting I need to do, for now the most important thing is content. Once I have completed the main bulk of my brain-dump on apache2buddy.pl, I will begin the polishing process.
            </p>
            <div class="no-print">
                <div class="backtop"><a href="#top">^ Back to top ^</a></div>
            </div>
        </section>
        <a id="origins" class="anchor"></a>
        <section class="history container">
            <a id="origins" class="anchor"></a>
            <p style="page-break-before: always"></p>
            <h2>EARLY ORIGINS:</h2>
            <h4 class="display-6">Meet the grandfather of apache tuning... <br>
                <strong>apachebuddy.pl</strong></h4>
            <p>
                    If you're new to apache2buddy.pl, in order to really understand the evolution of the script that we know and love today, we have to first go back and meet the grandfather of apache tuning, <strong>apachebuddy.pl</strong>.
            </p>
            <p>
                    <strong>apachebuddy.pl</strong> was originally a collaborative project by several Rackspace employees, and was originally built specifically to support <strong>Red Hat Enterprise Linux</strong> systems. It has always been an open source project so it wasn't restricted to internal use at the Rack (so this isn't just an internal tool - its used by people all over the world), however, it was, shall we say <em>mainly</em> used by Rackspace employees to provide support to our customers running Red Hat Enterprise Linux Systems and the Linux, Apache, MySQL, and PHP (LAMP) stack. Without revealing too much in terms of Intellectual Property or internal processes of Rackspace, we have to acknowledge it's birthplace to get a true grip on the factors that influenced it's development.
            </p>
            <p>
                    In apachebuddy.pl's hey-day, Red Hat Enterprise Linux (RHEL) was the <em>only</em> available operating system we sold / supported on the Linux support floor, so of course it made sense to code apachebuddy.pl accordingly, this may go some way to explain the difference in the size of the code base of apachebuddy.pl when we compare it with apache2buddy.pl (see Fig 1), since it was only written to cater to RHEL systems:
            </p>
            <div class="factblock skiptranslate">apachebuddy.pl
1102 lines of perl code
last commit: 5 years ago.*
----------------------------------------------------------
apache2buddy.pl
2706 lines of perl and some python code
last commit: 8 days ago.*

* as of this writing (Wednesday January 16th, 2019).
            </div>
            <div class="figtext">
                Fig 1: Differences in line count and last commit.
            </div>
            <p>
                    Of course that was 5+ years ago now and times move on, a need arose for further support, as support in the Linux Department expanded to cater mainly for Ubuntu and Debian systems, in addition to Red Hat Enterprise Linux, and it's open source cousin, CentOS. However the apachebuddy project was abandoned by that point and is no longer maintained, but was kept on a external facing github account and has the domain "apachebuddy.pl".
            </p>
            <p>
                    You can view the original project <a href="https://github.com/gustavmaskowitz/apachebuddy.pl" target="_blank">here</a>.
            </p>
            <p>
                    If you're also into raw code, you can view it at the domain above or click <a href="https://raw.githubusercontent.com/will-parsons/apachebuddy.pl/master/apachebuddy.pl" target="_blank">here.</a>
            </p>
            <p>
                    The idea behind the domain pointing at the raw code was to allow one to run <strong>apachebuddy.pl</strong> through a commandline process known as "curl and perl", where you curl the domain and pipe it into perl (see Fig 2):
            </p>
            <p class="codeblock skiptranslate"  id="fig2">
                    # curl -sL apachebuddy.pl | perl
            </p>
            <div class="figtext">
                    Fig 2: An example of the curl-and-perl technique.
            </div>
            <p>
                    Note: the domain <strong>apachebuddy.pl</strong> points to https://raw.githubusercontent.com/will-parsons/apachebuddy.pl/master/apachebuddy.pl, NOT the "gusmaskowitz" one.
            </p>
            <p>
                    It's important to note that no one maintains apachebuddy.pl, it is an abandoned project that is hosted for posterity reasons. Some people still use it, but many people have now started using apache2buddy.pl instead, so lets find out why....
            </p>
            <div class="no-print container">
                <div class="backtop"><a href="#top">^ Back to top ^</a></div>
            </div>
        </section>
        <a id="polish"></a>     
        <section class="polishdomain container">
            
            <p style="page-break-before: always"></p>
            <h2>What is with the polish domain?</h2>
            
            <p>The .pl dns top level domain is indeed Polish. However, it is (probably not in the spirit of the IETF/IANA but hey, people are people) used (possibly inappropriately but from a tech point-of-view is a stroke of genius) to host perl scripts because they also happen to share the same file extension (.pl).</p>
            
            <p>One of the most iconic examples of these domains is the <a href="http://mysqltuner.pl" target="_blank">MySQLTuner project</a>, looked after by Major Hayden. mysqltuner is hosted on the mysqltuner.pl domain. This may also explain the phenomenon known as the  <a href="#fig2">perl and curl method</a> we discussed earilier.</p>
            <div class="no-print">
                <div class="backtop"><a href="#top">^ Back to top ^</a></div>
            </div>
        </section>
        
        <a id="intro"></a>
        <section class="intro container">
            
            <p style="page-break-before: always"></p>
            <h2>Introduction to apache2buddy. How I got involved.</h2>
            <p>I spoke to Will Parsons who hosts the project on <a href="https://github.com/will-parsons">his github account</a>, about 5 years ago (circa 2013-14), asking him if there were any plans to update it to support Debian and Ubuntu Systems.</p>
            <p>I was told that the code wasn't actually his, and that it was no longer being maintained anyway, and he had no plans to make any updates to apachebuddy.pl.</p>
            <p>I asked him if he didnt mind if I took a copy of it and forked it into a new project, to see what I could do to solve the problems with it not running on Debian or Ubuntu Systems.</p>
            <p>I say "fork" here loosely, as at that time I had no github/git training or knowledge, so I copied the code into a vim editor and originally hosted the apache2buddy project and its associated domain on a LAMP server running in the cloud. I editted the file manually eacg tiime it needed updating, and had no change control or proper backups in place.</p>
            <p>This, as you can imagine, wasnt very easy to maintain, but, over time I grew to learn and adopt git/github repositories and learnt how to commit changes, slowly over time I migrated away from a LAMP server to hosting the code on my own github repository:</p>
            <div class="factblock skiptranslate">https://github.com/richardforth/apache2buddy</div>
            <p class="figtext">Fig 4: The home of apache2buddy.pl</p>
            <p>Originally I had the domain <strong>apache2buddy.pl</strong> pointed to the <a href="https://raw.githubusercontent.com/richardforth/apache2buddy/master/apache2buddy.pl" target="_blank">raw code</a>, just like Will did with the original <strong>apachebuddy.pl</strong>domain (see <a href="#fig5">curl and perl method</a>).</p>
            <p>However I got itchy feet and a tick in my face whenever I gave any thought to the fact that the <a href="#fig5">curl and perl method</a> was open to malicious bad actors typocamping/typosquatting <sup>[<a href="#biblio2">2</a>][<a href="#biblio3">3</a>]</sup> on slightly mispelled domains. It kept me up at night that this also had to be done as root, on systems globally. Even though I knew I wasn't really responsible for end users doing something silly like curling and mistyping a domain name, and then piping that into perl, as root (and enabling some bad actor which maybe registered a mis-spelt version of the apache2buddy.pl domain in the hope they catch a fish with a malicious root compromise perl script or bitcoin miner or something equally unwelcome).</p>
            <p>So to that end I pointed the domain away from the code and forced people who still wished to curl and perl, use the whole complete github path to the raw code, since it was much more difficult to land in hot water due to a mistyped URL:
            <div class="codeblock skiptranslate"  id="fig5"># curl -sL apache2buddy.pl | perl</div>
            <p class="figtext">Fig5: The curl and perl method we ran originally. This no longer works, you will get errors.</p>
            <div class="codeblock skiptranslate"># curl -sL https://raw.githubusercontent.com/richardforth/apache2buddy/master/apache2buddy.pl | perl</div>
            <p class="figtext">Fig 6: The curl and perl method we run today.</p>
            <p>While the first example looks more aesthetically pleasing to the eye, and is easy to remember, as commands go, it was vulnerable to a typosquatting attack, consider the following BAD command (trigger warning - I have no idea if that domain is registered and if it has a malicious perl code behind it - it's just an example to illustrate what I mean by typo-squatting attacks).
            <div class="codeblock skiptranslate"># curl -sL apache2buddy.pl | perl</div>
            <p class="figtext">Fig 7: An example of a mistyped domain in a command that could run other, potentially arbitraryor malicious perl code (as root).</p>
            <p>Did you notice in Figure 7 that there were three d's in this last example? Suppose someone wrote a bad perl script and you mistyped the domain as above.... well, through your own fat, sausage fingers, you now <em>potentiially</em> aided in a third party root compromising your server. Slow clap...</p>
            <p>Though I could never take responsibility for your own faux pas, I decided to no longer support using the domain name as part of the curl and perl technique as a saftey precaution, and so repointed it  - originally to a blog, then to this page (you get some random perl errors because perl would try to parse HTML).</p>
            <p>For about a year during the transition amd before I finally pointed the domain to a wordpress blog, effectively breaking it, I first created a simple perl script that printed a public service announcement on the terminal window, advising them that the new method was as per Fig 5 (above), and that eventually curling the domain and piping it into perl would not work, and pointed the domain to that.<sup>[ reference needed ]</sup></p>
            <p>That pretty much brings you up to speed on how apache2buddy.pl came to be, and how I got involved, without delving too deep into code, but don't be fooled - I'm breaking you in gently...</p>
            <div class="no-print container">
                <div class="backtop"><a href="#top">^ Back to top ^</a></div>
            </div>
        </section>
        
        <a id="shortcomings"></a>
        <section class="shortcomings container">
            
            <p style="page-break-before: always"></p>
            <h2>Shortcomings of the original.</h2>
            <p>The original <strong>apachebuddy.pl</strong> had a couple of major shortcomings. Firstly it only ever gave you a calculation of Maxclients/MaxRequestWorkers based on total installed RAM and <em>not</em> taking into consideration any running services that consume RAM.</p>
            <p>Secondly, but more pressingly at the time, the main issue was that <strong>apachebuddy.pl</strong> only worked on Red Hat Enterprise Linux systems, it didn't run on Ubuntu or Debian systems* which came into support at Rackspace around 5 years ago, a solution had to be found.</p>
            <p><em>* I beleive it does now, but it is not maintained, and hasnt been committed to in over 5 years, and can be hit and miss.</em></p>
            <div class="codeblock skiptranslate">[root@web1 ~]# curl -sL apachebuddy.pl | perl
########################################################################
# Apache Buddy v 0.3 ###################################################
########################################################################
Gathering information...
We are checking the service running on port 80
The process listening on port 80 is /usr/sbin/httpd
The process running on port 80 is not Apache.
 Falling back to process list...
Could not find Apache process. Exiting...
            </div>
            <p class="figtext">Fig3: The original and unmaintained apachebuddy.pl script output, not to be confused with apache2buddy.pl. It doesnt like CentOS 7  / apache 2.4 it seems.</p>
            <p>That demo using CentOS 7 backfired, however I posted it's output as a show of just how unreliable it has become.</p> 
            <div class="codeblock skiptranslate">
We are checking the service running on port 80
The process listening on port 80 is /usr/sbin/httpd
The process running on port 80 is not Apache.
            </div>
            <p class="figtext">Fig3a: Pretty sure thats apache.</p>
            
            <p>I will do another run on a CentOS 6 machine to get you a copy of the full output. Here goes....</p>
            
            <div class="codeblock skiptranslate">[root@web2 ~]# curl -sL apachebuddy.pl | perl
########################################################################
# Apache Buddy v 0.3 ###################################################
########################################################################
Gathering information...
We are checking the service running on port 80
The process listening on port 80 is /usr/sbin/httpd
The process running on port 80 is Apache/2.2.15 (Unix)
Apache has been running 0d 0h 00m 29s
The full path to the Apache config file is: /etc/httpd/conf/httpd.conf
Apache is using prefork model

Examining your Apache configuration...
Apache runs as apache
Your max clients setting is 256

Analyzing memory use...
Your server has 990 MB of memory
The largest apache process is using 4.74 MB of memory
The smallest apache process is using 4.74 MB of memory
The average apache process is using 4.74 MB of memory
Going by the average Apache process, Apache can potentially use 1213.45 MB RAM (122.58 % of available RAM)
Going by the largest Apache process, Apache can potentially use 1213.45 MB RAM (122.58 % of available RAM)

Generating reports...
### GENERAL REPORT ###

Settings considered for this report:

        Your server's physical RAM:             990MB
        Apache's MaxClients directive:          256
        Apache MPM Model:                       prefork
        Largest Apache process (by memory):     4.74MB
[ !! ]  Your MaxClients setting is too high. It should be no greater than 208.
        Max potential memory usage: 1213.44 MB(122.57 % of available RAM)

        Percentage of RAM allocated to Apache           122.57 %

-----------------------------------------------------------------------
-----------------------------------------------------------------------
[root@web2 ~]#

            </div>
            <p class="figtext">Fig3: The original and unmaintained apachebuddy.pl script output from CentOS 6, not to be confused with apache2buddy.pl. It doesnt like CentOS 7  / apache 2.4 it seems</p>
            
            <p>Here we see a successful run on a CentOS 6.10 machine. But since it doesnt run on CentOS 7, its quickly becoming less functional. Note also how it has calculated a maxclients value based on 990MB of RAM and a largest proces size of 4.74 MB of memory. This is a fairly rudimentary calculation that doesn't consider any other running services on the system that might consume memory. So the recommendation based on total installed RAM is of limited value, what we need is a calculation based on remaining RAM after key services have been taken into consideration.</p>
            <p> Though it seems like I might be just completely dismissive of apachebuddy.pl, I actually owe it a ton of respect, like a village elder, as <strong>apachebuddy.pl</strong> is the forefather of apache2buddy.pl, which builds upon the foundations laid down by <strong>apachebuddy.pl</strong> originally. 
            <div class="no-print container">
                <div class="backtop"><a href="#top">^ Back to top ^</a></div>
            </div>
        </section>
        
        <a id="improvements"></a>
        <section class="section-improvements container">
            
            <p style="page-break-before: always"></p>
            <h2>A high - level summary of the key improvements to apache2buddy.pl</h2>
            <ul>
                <li>Added support for Scientific Linux systems.</li>
                <li>Added support for CentOS systems.</li>
                <li>Added support for Debian systems.</li>
                <li>Added support for Ubuntu systems.</li>
                <li>Added support for SuSE systems. (thanks to psytester)<sup>[ reference needed ]</sup></li>
                <li>Takes into account other services' memory usage.
                    <ul>
                        <li>Java</li>
                        <li>MySQL / MariaDB / Percona</li>
                        <li>Gluster</li>
                        <li>Redis</li>
                        <li>Varnish</li>
                        <li>PHP-FPM</li>
                    </ul>
                </li>
                <li>Maxclients/MaxRequestWorkers is calculated on <em>remaining</em> RAM, <strong>not</strong> <em>total installed</em> RAM.</li>
                <li>Has capability to detect cPanel, webmin and Plesk (critical to alert administrators that they probably should'nt be tweaking config files manually, or at least be extra careful).</li>
                <li>Checks for, and reports available/pending php and apache package updates.</li>
                <li>Checks log files for PHP Fatal Errors.</li>
                <li>Creates, or appends to a log file in /var/log, for historical review.</li>
                <li>Detects PHP-FPM and recommends an alternative tuning script<sup>[ reference needed ]</sup>.</li>
            </ul>
            <div class="no-print container">
                <div class="backtop"><a href="#top">^ Back to top ^</a></div>
            </div>
        </section>
        
        <a id="publicity"></a>
        <section class="publicity container">
            <a id="publicity"></a>
            <p style="page-break-before: always"></p>
            <h2>Unprompted (but welcome) publicity received for apache2buddy.pl.</h2>
            <p>
              Apache2buddy caught the attention of TechRepublic a few years back and they wrote an article telling people "How to tune apache webserver in seconds". This was pretty awesome and I was stoked that I made a respected online publication.
            </p>
            <p>
              You can read that article <a href="http://www.techrepublic.com/article/how-to-tune-apache-in-seconds-with-apache2buddy-pl/" target="_blank">here</a>.
            </p>
            <p>
                These reviews were completely independent, I have no idea who wrote them or how they came to be, they were certainly not solicited by me…..but…..welcome all the same :)
            </p>
            <div class="no-print">
                <div class="backtop"><a href="#top">^ Back to top ^</a></div>
            </div>
        </section>
        <section class="section-support container">
            <a id="os-support"></a>
            <p style="page-break-before: always"></p>
            <div class="row">
                <h2>Supported Operating Systems</h2>
            </div>
            <p>These are the operating systems that are OFFICIALLY supported.<p>
            <ul>
                <li>Red Hat Enterprise Linux.</li>
                <li>CentOS.</li>
                <li>Scientific Linux.</li>
                <li>Debian.</li>
                <li>Ubuntu.</li>   
            </ul>
            <p>
                Note that it may run just fine on others, but that would be a fluke and not by any design. Support follows as much as possible, the original OS lifecycle dates (ie, when the vendor EOLs the OS, I remove it from apache2buddy support. The script will NOT run on EOL systems.
            </p>
            <p>
                But, I hear you say, what if I have a business need to run old cruddy hardware and unpatched systems? Or what if my OS isn't supported by apache2buddy.pl? How can I force it to run?
            </p>
            <p>
                <em>Come with me my friend, for the answers you seek lay just ahead...</em>
            </p>
            
            
            <div class="no-print">
                <div class="backtop"><a href="#top">^ Back to top ^</a></div>
            </div>
        </section>
        
        <a id="os-unsupport"></a>
        <section class="section-unsupport container">
            <p style="page-break-before: always"></p>
            <a id="os-unsupport"></a>
            <div class="row">
                <h2>What do I do if my OS isnt listed under "Supported Operating Systems"?</h2>
            </div>            
            <p>
                Welome to the world of Free and Open Souce Software (FOSS). I have had many requests to add support for other operating systems, and the answer has always been no, and it always will be.
            </p>
            <p>
                But, I am not a monster. Here are some high-level suggestions on how I would recommend you proceed. We can deep dive into each option as required:   
            </p>
            <ul>
                <li>Fork the project on github. Make your own custom changes to the script.</li>
                <li>Download or git-clone the repo locally and just do a one-time edit to make it run.</li>
            </ul>

            <p>At the end of the day, I can only do so much testing, and I chose, for my own sanity, to only support the big four OSes, Debian, and its most famous branch-off - Ubuntu, and of course RHEL, and the two other major distros based on that CentOS and Scientific.</p>
            <p>I have never prevented anyone from hacking their own private version of the script, so long as they adhere to the spirit of the Apache 2.0 License.</p>
            <p>So lets go on a journey of discovery as I walk you through a fictional scenario: we are going to fudge apache2buddy to run on an unsupported OS Version.</p>
            <h3>The Dilemma</h3>
            <p>You have a requirement to tune apache on a CloudLinux 7 machine, but apache2buddy exits with an error stating that it only currently supports a certain list of RED Hat based OSes, but we know that CloudLinux is based on Red Hat Enterprise Linux.</p>
            <h3>The Proposition / Solution</h3>
            <p>We are going to download the code locally with wget, and then hack the perl script and make some changes, and try to execute it again.</p>
            <h3>Begin...</h3>
            <p>Our first job is to download the perlscript locally, lets save it to root's home area, /root</p>
            <p class="codeblock skiptranslate"># wget -O /root/apache2buddy.pl https://raw.githubusercontent.com/richardforth/apache2buddy/master/apache2buddy.pl</p>
            <p class="figtext">Fig 8: Saving the script locally with wget.</p>
            <p>Before we proceed further, I do want to talk a bit about editors. Honestly its up to you what editor you use, if it's nano, a small kitten dies so lets avoid that, just kidding. I recommend that you use an editor that allows you to quickly and easily identify line numbers, and it must be a command-line editor (the assumption here is your production servers arent running a GUI (though seriously one time I found a rackmounted server running X windows and gnome-screensaver....take as long as you need on that one...</p>
            <p>Anyway the point I am getting at is that in these examples I will be walking you through the edits with vi/vim, and using line numbers that made sense as of this writing, but as you know time stands still for no man and, well, line numbers may not be the same in a few years time. Its still an active project.</p>
            <p>So if I say, on line 80 change this value to that value, and the line i am quoting loks nothing like the line 80 youre working on, have a look in that general area of the code, as things get added or removed, the code I may have been referring to may not be on line 80 any more, but it won't have drifted too far I would'nt have thought. Use your noggin before you complain.</p>
            <p>So, if you havent already, make sure you have the following in your <strong>.vimrc</strong> file in root's home as a minimum:</p>
            <p class="codeblock skiptranslate">set number</p>
            <p class="figtext">Fig 9: Setting line numbers in vim using a runtime config file /root/.vimrc</p>
            <p>Now edit the file:</p>
            <p class="codeblock skiptranslate"># vim /root/apache2buddy.pl</p>
            <p class="figtext">Fig 10: Opening up apache2buddy.pl in the vim editor.</p>
            <p>Next, we go to line 337 and heed the warning, you can either scroll down untill you get to line 337 or press ESC and then type:</p>
            <p class="codeblock">337g</p>
            <p class="figtext">Fig 11: Moving quickly to line 337 in the vim editor.</p>
            <p>Observe the warning in the comments:</p>
            <p class="codeblock skiptranslate"># Please dont make pull requests to add your distro to this list, that doesnt make it supported.
# The following distros are what I use to test and deploy apache2buddy and only these distro's are supported.</p>
            <p class="figtext">Fig 12: Comments save lives, always read comments.</p>
            <p>Add "CloudLinux" to the list of supported Oses:</p>
            <p class="codeblock skiptranslate">my @supported_os_list = ('Ubuntu',
				'ubuntu',
				'Debian',
				'debian',
				'Red Hat Enterprise Linux',
				'Red Hat Enterprise Linux Server',
				'redhat',
				'CentOS Linux',
				'CentOS',
				'centos',
				'Scientific Linux',
				'SUSE Linux Enterprise Server',
                                'SuSE'<mark>,</mark>
                                <mark>'CloudLinux'</mark>);
            </p>
            <p class="figtext">Fig 13: Adding CloudLinux to the list of supported OSes.</p>
            <p>Next we need to move to line 360</p>
            <p class="codeblock skiptranslate">360g</p>
            <p class="figtext">Fig 14: Moving quickly to line 360 in the vim editor.</p>
            <p>Again, add "CloudLinux" to the list of supported Oses:</p>
            <p class="codeblock skiptranslate">my @redhat_os_list = ('Red Hat Enterprise Linux', 'redhat', 'CentOS Linux', 'Scientific Linux'<mark>,'CloudLinux'</mark>);</p>
            <p class="figtext">Fig 15: Adding CloudLinux to the list of supported OSes.</p>
            <h3>"HOLD UP......WAIT A MINUTE.....SOMETHING AIN'T RIGHT...."<sup>[<a href="#biblio4">4</a>]</sup></h3>
            <p>I know what youre thinking; this was way too easy, why dont I just add support for cloudlinux and be done with it.</p>
            <p>So.... all we have done so far is <em>tricked</em> the AI here into thinking that apache2buddy will run fine on CloudLinux. <em>but of course, theres no guarrantee it will</em>.</p>
            <p class ="main-text">I have even added a <strong>--skip-os-version-check</strong> option to make it even easier to execute:</p>
            <p class="codeblock skiptranslate"># curl -sL https://raw.githubusercontent.com/richardforth/apache2buddy/master/apache2buddy.pl | perl - --help

Usage: apache2buddy.pl [OPTIONS]
If no options are specified, the basic tests will be run.

	-h, --help		     Print this help message
	-p, --port=PORT		     Specify an alternate port to check (default: 80)
	    --pid=PID		     Specify a PID to bypass the "Multiple PIDS listening on port 80" error.
	-v, --verbose		     Use verbose output (this is very noisy, only useful for debugging)
	-n, --nocolor		     Use default terminal color, dont try to be all fancy! 
	-H, --noheader		     Do not show header title bar.
	-N, --noinfo		     Do not show informational messages.
	-K, --no-ok	 	     Do not show OK messages.
	-W, --nowarn		     Do not show warning messages.
	-L, --light-term	     Show colours for a light background terminal.
	-r, --report		     Implies -HNWK or --noinfo --nowarn --no-ok --noheader --skip-maxclients --skip-php-fatal --skip-updates
	-P, --no-check-pid	     DON'T Check the Parent Pid File Size (only use if desperate for more info, results may be skewed).
	    --skip-maxclients	     Skip checking in maxclients was hit recently, can be slow, especialy if you have large log files.
            --skip-php-fatal         Skip checking for PHP FATAL errors, can be slow, especialy if you have large log files.
            --skip-updates           Skip checking for package updates, can be slow or problematic, causing the script to hang.
	<mark>-O, --skip-os-version-check  Skips past the OS version check.
                                     Allows one to bypass EOL version showstopper but be mindful:
                                      skipping the os version check is not recommended as features may be 
                                      deprecated or removed and apache2buddy is not backward compatible 
                                      with end of life operating systems, this may cause errors and unpredictable 
                                      behaviour.</mark>


Key:

    [ -- ]  = Information
    [ @@ ]  = Advisory
    [ >> ]  = Warning
    [ !! ]  = Critical


#</p>
            <p class="figtext">Fig 16: Help, outlining the option to skip OS version checks altogether, note that things might not go as well as you might hope.</p>
            <p class ="main-text">The method I outlined here will get you so far, but you may have to fix other errors that crop up as you'll be running apache2buddy.pl in unknown territory. The above edits may or may not allow the script to run to completion.</p>
            <p>If you are a really competent perl / python coder, you can do what <strong>psytester</strong> did and submit a pull request to add OS support, which <strong>psytester</strong> did to add support to SuSE Linux systems, I merged <strong>psytester</strong>'s changes <a href="https://github.com/richardforth/apache2buddy/pull/284/commits/cf48b9edae37745c35b305ff59cc1198854f878d" target="_blank">here</a>, but note that I haven't acknowledged that SuSE is a Supported OS as I do not have the capability or capacity to test against SuSE systems. If it works, then great, if it does'nt, one hopes that <strong>psytester</strong> will submit further pull requests in the future to maintain support for SuSE.</p>
            <div class="no-print">
                <div class="backtop"><a href="#top">^ Back to top ^</a></div>
            </div>
        </section>
        <div class="no-print">
            <div class="clearscroll"></div>
        </div>

        <a id="usecases"></a>
        <section class="section-usecases container">
            <p style="page-break-before: always"></p>
            <h2>Use Cases.</h2>
            <div class="row">
                <p>
                    Reasons why you would want to run apache2buddy.pl on your server.
                    <ul>
                        <li>Post Mortem Investigation and Tuning Apache after an Incident attributed to apache, such as:</li>
                        <ul>
                            <li>Heavy Swapping</li>
                            <li>Kernel panic</li>
                            <li>MaxClients / MaxRequestWorkers hit consistently.</li>  
                        </ul>
                        <li>Discovering facts and using apache2buddy as a one time execution dashboard of point-in-time (PIT) information about the server.</li>
                        <li>Review historical log entries to observe trends.</li>
                        <li>Check for apache / php package updates</li>
                        <li>Check for the presence of any Control Panels (cPanel, Webmin, Plesk)</li>
                        <li>...and much more.</li>
                    </ul>
                </div>
            <div class="no-print">
                <div class="backtop"><a href="#top">^ Back to top ^</a></div>
            </div>
        </section>
        
        <a id="bestpractices"></a>
        <section class="bestpractice container">
            <p style="page-break-before: always"></p>
            <h2>Best practices when working with apache2buddy.pl</h2>
            <h4>"Anyone can swing a sword, but only the Samurai know how to truly handle it with grace and skill."</h4>
            <p>Let's deal with the elephant in the room: apache2buddy.pl produces a LOT of output, and it is <em>NOT</em> designed to be the club with which you beat your customers over the head.</p>
            <p>Think of it like a dashboard, or a fighter-pilot's HUD (Heads Up Display), so that you, the discerning System Administrator, can use the information to help you come to a business decision and use <em>PARTS</em> of the output, to help your case when influencing others, be they a customer in a support ticket, your technical director, server teams, management, or other invested parties.</p>
            <p>I can categorically affirm that it was <em>not</em> built to be user friendly or customer-facing - it's a <em>technical tool</em> for <em>technical people</em>. That's not to say that technically minded end-users are forbidden from running it, but if you as a Systems Admnistrator are slapping your non-technical customers with the full output from apache2buddy.pl, or even apachebuddy.pl - like the Hammer of Thor - then you're not using it correctly.</p>
            <p>In the next section we will learn how to get, execute, and run the script, as well as how to interpret the results and present your case in your own words, appropriately, using small snippets of output to highlight certain facts. At the end of that section, I will do a fake update/email/ticket that shows best practice in using apache2buddy findings <em>effectively</em> in your communications.</p>
            <div class="no-print">
                <div class="backtop"><a href="#top">^ Back to top ^</a></div>
            </div>
        </section>
        <div class="clearscroll noprint"></div>
        <a id="walkthrough"></a>
        <section class="interpretation container">
            <p style="page-break-before: always"></p>
            <h2>Walkthrough and interpretation of the results:<br><strong>an example scenario and execution run.</strong></h2>
            <p>In this section I walk you through an execution run of apache2buddy.pl, breaking down relevant sections and providing a commentary around it, what I check, how it checks, and any remedial action necessary. I will finish up with an example update to a customer using apache2buddy as my guide and reference point.</p>
            <p>Before we break it down, let's take a look as a full execution run output. We can then take some time to break each section down for discussion.</p>
            <p class="codeblock skiptranslate">[root@web1 ~]# curl -sL https://raw.githubusercontent.com/richardforth/apache2buddy/master/apache2buddy.pl | perl
############################################################
apache2buddy.pl report for web1.example.com (xxx.xxx.xx.xxx)
############################################################
[ OK ] This script is being run as root.
[ OK ] The utility 'pmap' exists and is available for use: /usr/bin/pmap
[ OK ] The utility 'netstat' exists and is available for use: /usr/bin/netstat
[ OK ] 'php' exists and is available for use: /usr/bin/php
[ OK ] The utility 'apachectl' exists and is available for use: /usr/sbin/apachectl
[ OK ] The 'python' binary exists and is available for use: /usr/bin/python
[ OK ] The port (port 80) is a valid port.
[ -- ] We are attempting to discover the operating system type and version number ...
[ -- ] Distro: CentOS Linux
[ -- ] Version: 7.6.1810
[ -- ] Codename: Core
[ OK ] This distro is supported by apache2buddy.pl.
[ OK ] This distro version is supported by apache2buddy.pl.
[ -- ] Hostname: web1.example.com
[ -- ] Primary IP: xxx.xxx.xx.xxx
[ -- ] We are checking the service running on port 80...
[ -- ] The process listening on port 80 is /usr/sbin/httpd
[ -- ] The process running on port 80 is Apache/2.4.6 (CentOS).
[ -- ] The full path to the Apache config file is: /etc/httpd/conf/httpd.conf
[ -- ] Apache is using prefork model.
[ -- ] pidfile setting is CONFIG NOT FOUND.
[ -- ] Actual pidfile is /run/httpd/httpd.pid.
[ -- ] Parent PID: 4769.
[ OK ] Memory usage of parent PID is less than 50MB: 5396 Kilobytes.
[ -- ] Apache has been running 0d 01h 03m 25s.
[ !! ] *** LOW UPTIME ***.
[ @@ ] The following recommendations may be misleading - apache has been restarted within the last 24 hours.
[ -- ] Your server has 985 MB of PHYSICAL memory.
[ >> ] ServerLimit directive not found, assuming default values.
[ -- ] Your ServerLimit setting is 256.
[ >> ] MaxRequestWorkers directive not found, assuming default values.
[ -- ] Your MaxRequestWorkers setting is 256.
[ OK ] Current Apache Process Count is 6, including the parent PID.
[ -- ] Number of vhosts detected: 0.
[ OK ] Current Apache vHost Count is less than maxrequestworkers.
[ @@ ] vHost Count works only when we have NameVirtualHosting enabled, check config manually, they may only have the default vhost.
[ >> ] MaxRequestsPerChild directive not found.
[ -- ] This server is NOT running Plesk.
[ -- ] This server is NOT running cPanel.
[ -- ] This server is NOT running Virtualmin.
[ -- ] Your PHP Memory Limit (Per-Process) is 128M.
[ OK ] No additional services were detected.
[ OK ] No large log files were found in /var/log/httpd.
[ OK ] MaxClients has not been hit recently.
[ >> ] Apache only logs maxclients/maxrequestworkers hits once in a lifetime, if no restart has happened this event may have been rotated away.
[ >> ] As a backup check, please compare number of running apache processes (minus 1 for parent) against maxclients/maxrequestworkers.
[ >> ] For more information see https://github.com/apache/httpd/blob/0b61edca6cdda2737aa1d84a4526c5f9d2e23a8c/server/mpm/prefork/prefork.c#L809
[ OK ] No PHP Fatal Errors were found.
[ OK ] No package updates found.
[ -- ] httpd is currently using 41.52 MB of memory.
[ -- ] The smallest apache process is using 5.27 MB of memory
[ -- ] The average apache process is using 5.27 MB of memory
[ -- ] The largest apache process is using 5.27 MB of memory
[ !! ] Going by the average Apache process, Apache can potentially use 1349.12 MB RAM:
                Without considering services: 136.97 % of total installed RAM
                Considering extra services: 136.97 % of remaining RAM
[ !! ] Going by the largest Apache process, Apache can potentially use 1349.12 MB RAM:
                Without considering services: 136.97 % of total installed RAM
                Considering extra services: 136.97 % of remaining RAM


--------------------------------------------------------------------------------
### GENERAL FINDINGS & RECOMMENDATIONS ###
--------------------------------------------------------------------------------
Apache2buddy.pl report for server: web1.example.com (xxx.xxx.xx.xxx):

Settings considered for this report:
[ !! ] *** LOW UPTIME ***.
[ @@ ] The following recommendations may be misleading - apache has been restarted within the last 24 hours.

        Your server's physical RAM:                                   985 MB
        Remaining Memory after other services considered:             985 MB
        Apache's MaxRequestWorkers directive:                         256      <--------- Current Setting
        Apache MPM Model:                                             prefork
        Largest Apache process (by memory):                           5 MB
[ !! ]  Your MaxRequestWorkers setting is too high.
        Your recommended MaxRequestWorkers setting (based on available memory) is between 167 and 186. <------- Acceptable Range (10% of MAX)
        Max potential memory usage:                                   1349 MB
        Percentage of TOTAL RAM allocated to Apache:                  136.97  %
        Percentage of REMAINING RAM allocated to Apache:              136.97  %
--------------------------------------------------------------------------------
A log file entry has been made in: /var/log/apache2buddy.log for future reference.

Last 5 entries:

2019/01/19 10:53:17 Uptime: "0d 01h 03m 25s" Model: "Prefork" Memory: "985 MB" MaxRequestWorkers: "256" Recommended: "186" Smallest: "5.27 MB" Avg: "5.27 MB" Largest: "5.27 MB" Highest Pct Remaining RAM: "136.97%" (136.97% TOTAL RAM)

            </p>
            <p class="figtext">Fig 17: Output from apache2buddy.pl - not to be used as a club to beat your customers into submission.</p>
            
            <p>Next we will inspect and discuss the relevant parts of the output in more detail.</p>
            <p>Analysis to follow.</p>
            <div class="no-print">
                <div class="backtop"><a href="#top">^ Back to top ^</a></div>
            </div>
        </section>
        <div class="no-print">
            <div class="clearscroll"></div>
        </div>
        
        <a id="known-issues"></a>
        <section class="section-knownissues container">
            
            <p style="page-break-before: always"></p>
            <h2>Known Issues</h2>
            <p>All current issues can be raised or tracked directly on GitHub <a href="https://github.com/richardforth/apache2buddy/issues">here</a>. or using the yellow button at the top of this document.</p>
            <div class="no-print">
                <div class="backtop"><a href="#top">^ Back to top ^</a></div>
            </div>
        </section>
        
        <section class="reportingissues container">
            <p style="page-break-before: always"></p>
            <h2>Reporting Issues</h2>
            <p>Issues can be raised directly on GitHub <a href="https://github.com/richardforth/apache2buddy/issues">here</a>. or using the yellow button at the top of this document.</p>
            <div class="no-print">
                <div class="backtop"><a href="#top">^ Back to top ^</a></div>
            </div>
            <p style="page-break-before: always"></p>
        </section>
        <div class="no-print">
            <div class="clearscroll"></div>
        </div>
        
        <a id="references"></a>
        <section class="section-references container">
            <p style="page-break-before: always"></p>
            <h2>References:</h2>
            <div class="biblio">[1] The Apache2Buddy Project Github Page.<br> - <a href="https://github.com/richardforth/apache2buddy" target="_blank">https://github.com/richardforth/apache2buddy</a></div>
            <br> 
            <div class="biblio">[2] McAfee Article on Typesquatting.<br> - <a href="https://securingtomorrow.mcafee.com/consumer/family-safety/what-is-typosquatting/" target="_blank">https://securingtomorrow.mcafee.com/consumer/family-safety/what-is-typosquatting/</a></div>
            <br> 
            <div class="biblio">[3] Wikipedia Definition of Typosquatting.<br> - <a href="https://en.wikipedia.org/wiki/Typosquatting" target="_blank">https://en.wikipedia.org/wiki/Typosquatting</a></div>
            <br> 
            <div class="biblio">[4] YouTube "Hold up wait a minute" (original video).<br> - <a href="https://www.youtube.com/watch?v=vup0K8x4iKQ" target="_blank">https://www.youtube.com/watch?v=vup0K8x4iKQ</a></div>
            <div class="no-print">
                <div class="backtop"><a href="#top">^ Back to top ^</a></div>
            </div>
        </section>
        <a id="cookies"></a>
        <section class="section-cookies container no-print">
            <a id="cookies"></a>
            <h2>COOKIES ON THIS SITE</h2>
            <div class="long-copy-cookie">
                    I dont use or plan to use - cookies. If I do it will be for website functionality only. Currently there are no cookies used by any of the site code. There are no plans to advertise or allow 3rd party cookies that interfere with the site or track you in any way. 
            </div>
            <div class="long-copy-cookie">
                Though I don't advertise on this blog as of this writing, I may choose to in the future, and if I did accept advertisers, I would charge a design fee and an annual fee for hosting their advertisement - and I would write the ad's myself in html and css, and integrate them in a way that fits the style of the site, such as adding a section in between blog posts. None of these ads will be driven by cookies. I don't care what products you just looked at on amazon or wish.com. I have no interest in using 3rd party data. I just want you to enjoy my pain-free blog about my script apache2budd.pl.
            </div>
            <div class="long-copy-cookie">
                If you've never heard of cookies before and don't know what they are, you can <a href="https://cookiesandyou.com/" target="_blank">watch this video</a> and learn more from the "cookies and you" website.
            </div>
        </section>
        <section class="container">
            <p style="page-break-before: always"></p>
            <h2>Licensing, Printing, and Distribution of this document.</h2>
            <div class="copyleft">Feel free to print, copy and share.
                <div class="alert alert-success" role="alert">
                  &#9851; Consider the environment, this document has print-ready optimizations and therefore produces 22+ pages, consider printing to PDF or use double-sided printing. Thank you,
                </div>
                <br>This article, and the entire github pages project is protected under the Apache 2.0 <a href="https://raw.githubusercontent.com/richardforth/richardforth.github.io/master/LICENSE" target="_blank">Licence</a></div>
            <br>

            <div class="copyrightnotice skiptranslate">
                
                Copyright 2019 Richard A Forth

                Licensed under the Apache License, Version 2.0 (the "License");
                you may not use this file except in compliance with the License.
                You may obtain a copy of the License at

                    http://www.apache.org/licenses/LICENSE-2.0

                Unless required by applicable law or agreed to in writing, software
                distributed under the License is distributed on an "AS IS" BASIS,
                WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
                See the License for the specific language governing permissions and
                limitations under the License.</div>
        </section>
        <footer>
                Copyright &copy; 2019 Richard A. Forth (Web Design). All Rights Reserved.
  	    </footer>
        <script type="text/javascript">
                function googleTranslateElementInit() {
                  new google.translate.TranslateElement({pageLanguage: 'en'}, 'google_translate_element');
                }
        </script>

        <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
    </body>
</html>
